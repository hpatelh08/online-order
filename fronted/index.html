<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Canteen Login</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
  }
  .container {
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    padding: 40px;
    max-width: 500px;
    width: 100%;
  }
  h1 {
    text-align: center;
    color: #333;
    margin-bottom: 30px;
  }
  .user-type-tabs {
    display: flex;
    justify-content: space-around;
    margin-bottom: 30px;
    border-bottom: 2px solid #eee;
  }
  .tab {
    padding: 10px 20px;
    cursor: pointer;
    background: none;
    border: none;
    font-size: 16px;
    font-weight: bold;
    color: #666;
    position: relative;
    transition: all 0.3s;
  }
  .tab.active {
    color: #667eea;
  }
  .tab.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 100%;
    height: 3px;
    background: #667eea;
  }
  .form-container {
    display: none;
  }
  .form-container.active {
    display: block;
    animation: fadeIn 0.3s;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .form-group {
    margin-bottom: 20px;
  }
  label {
    display: block;
    margin-bottom: 5px;
    color: #333;
    font-weight: bold;
  }
  input {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
  }
  input:focus {
    outline: none;
    border-color: #667eea;
  }
  .otp-section {
    display: none;
    margin-top: 20px;
  }
  .otp-section.show {
    display: block;
  }
  button {
    width: 100%;
    padding: 12px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 10px;
    transition: transform 0.2s;
  }
  button:hover {
    transform: translateY(-2px);
  }
  button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
  .success-msg {
    color: green;
    text-align: center;
    margin-top: 10px;
  }
  .error-msg {
    color: red;
    text-align: center;
    margin-top: 10px;
  }
</style>
</head>
<body>

<div class="container">
  <h1>üçΩÔ∏è Canteen Login</h1>
  
  <div class="user-type-tabs">
    <button class="tab active" onclick="showForm('student')">Student</button>
    <button class="tab" onclick="showForm('teacher')">Teacher</button>
    <button class="tab" onclick="showForm('parents')">Parents</button>
  </div>

  <!-- Student Form -->
  <div id="studentForm" class="form-container active">
    <div class="form-group">
      <label>Enrollment Number</label>
      <input type="text" id="studentEnrollment" placeholder="12-digit enrollment" maxlength="12" required oninput="checkEnrollment()" />
    </div>
    <div class="form-group">
      <label>Student Name</label>
      <input type="text" id="studentName" placeholder="Enter your name" required />
    </div>
    <div class="form-group">
      <label>Department</label>
      <input type="text" id="studentDept" placeholder="Enter department" required />
    </div>
    <div class="form-group">
      <label>Phone Number</label>
      <input type="tel" id="studentPhone" placeholder="10-digit phone number" maxlength="10" required />
    </div>
    <button onclick="sendOTP('student')">Send OTP</button>
    
    <div id="studentOTP" class="otp-section">
      <div class="form-group">
        <label>Enter OTP</label>
        <input type="text" id="studentOtpInput" placeholder="Enter 6-digit OTP" maxlength="6" />
      </div>
      <button onclick="verifyOTP('student')">Verify OTP & Login</button>
    </div>
    <div id="studentMsg"></div>
  </div>

  <!-- Teacher Form -->
  <div id="teacherForm" class="form-container">
    <div class="form-group">
      <label>Phone Number</label>
      <input type="tel" id="teacherPhone" placeholder="10-digit phone number" maxlength="10" required oninput="checkTeacherPhone()" />
    </div>
    <div class="form-group">
      <label>Name</label>
      <input type="text" id="teacherName" placeholder="Enter your name" required />
    </div>
    <div class="form-group">
      <label>Department</label>
      <input type="text" id="teacherDept" placeholder="Enter department" required />
    </div>
    <button onclick="sendOTP('teacher')">Send OTP</button>
    
    <div id="teacherOTP" class="otp-section">
      <div class="form-group">
        <label>Enter OTP</label>
        <input type="text" id="teacherOtpInput" placeholder="Enter 6-digit OTP" maxlength="6" />
      </div>
      <button onclick="verifyOTP('teacher')">Verify OTP & Login</button>
    </div>
    <div id="teacherMsg"></div>
  </div>

  <!-- Parents Form -->
  <div id="parentsForm" class="form-container">
    <div class="form-group">
      <label>Parent Name</label>
      <input type="text" id="parentName" placeholder="Enter your name" required />
    </div>
    <div class="form-group">
      <label>Student Name</label>
      <input type="text" id="parentStudentName" placeholder="Enter student's name" required />
    </div>
    <div class="form-group">
      <label>Student Department</label>
      <input type="text" id="parentStudentDept" placeholder="Enter student's department" required />
    </div>
    <div class="form-group">
      <label>Phone Number</label>
      <input type="tel" id="parentPhone" placeholder="10-digit phone number" maxlength="10" required />
    </div>
    <button onclick="sendOTP('parents')">Send OTP</button>
    
    <div id="parentsOTP" class="otp-section">
      <div class="form-group">
        <label>Enter OTP</label>
        <input type="text" id="parentsOtpInput" placeholder="Enter 6-digit OTP" maxlength="6" />
      </div>
      <button onclick="verifyOTP('parents')">Verify OTP & Login</button>
    </div>
    <div id="parentsMsg"></div>
  </div>
</div>

<script>
  let currentUserType = 'student';
  let generatedOTP = '';
  let studentDatabase = {};
  let teacherDatabase = {};
  
  // Load student data from JSON file
  async function loadStudentData() {
    try {
      // Try multiple paths
      let response;
      try {
        response = await fetch('../backend/students.json');
      } catch (e) {
        response = await fetch('./backend/students.json');
      }
      
      if (!response.ok) {
        throw new Error('Failed to load students.json');
      }
      
      const data = await response.json();
      
      // Convert array to object for easy lookup
      studentDatabase = {};
      data.students.forEach(student => {
        studentDatabase[student.enrollment] = {
          name: student.name,
          department: student.department,
          phone: student.phone
        };
      });
      
      console.log('Student data loaded successfully:', studentDatabase);
    } catch (error) {
      console.error('Error loading student data:', error);
      
      // Fallback to hardcoded data if file can't be loaded
      studentDatabase = {
        '123456789012': {
          name: 'Raj Patel',
          department: 'Computer Science',
          phone: '9876543210'
        },
        '230606302032': {
          name: 'Hetu Patel',
          department: 'B.Sc. IT',
          phone: '9913368407'
        },
        '230606301079': {
          name: 'Haresh Bharwad',
          department: 'BCA',
          phone: '8758128324'
        },
        '230606302028': {
          name: 'Tanvi Patel',
          department: 'Information Technology',
          phone: '8160858355'
        },
        '230606302037': {
          name: 'Shankar parth',
          department: 'pharmacy',
          phone: '8567412565'
        },
        '230606302029': {
          name: 'Neel Shah',
          department: 'BBA',
          phone: '6351617981'
        },
        '987654321098': {
          name: 'Priya Shah',
          department: 'Information Technology',
          phone: '9123456789'
        },
        '456789012345': {
          name: 'Amit Kumar',
          department: 'Mechanical Engineering',
          phone: '9988776655'
        },
        '111222333444': {
          name: 'Sneha Desai',
          department: 'Civil Engineering',
          phone: '9876512340'
        },
        '555666777888': {
          name: 'Rahul Sharma',
          department: 'Electronics',
          phone: '9123498765'
        },
        '999888777666': {
          name: 'Rohan Mehta',
          department: 'Computer Engineering',
          phone: '9876543211'
        }
      };
      console.log('Using fallback student data');
    }
  }
  
  // Load data when page loads
  window.addEventListener('DOMContentLoaded', () => {
    loadStudentData();
    loadTeacherData();
  });
  
  // Load teacher data from JSON file
  async function loadTeacherData() {
    try {
      // Try multiple paths
      let response;
      try {
        response = await fetch('../backend/teachers.json');
      } catch (e) {
        response = await fetch('./backend/teachers.json');
      }
      
      if (!response.ok) {
        throw new Error('Failed to load teachers.json');
      }
      
      const data = await response.json();
      
      // Convert array to object for easy lookup
      teacherDatabase = {};
      data.teachers.forEach(teacher => {
        teacherDatabase[teacher.phone] = {
          name: teacher.name,
          department: teacher.department
        };
      });
      
      console.log('Teacher data loaded successfully:', teacherDatabase);
    } catch (error) {
      console.error('Error loading teacher data:', error);
      
      // Fallback to hardcoded data if file can't be loaded
      teacherDatabase = {
        '9876543210': {
          name: 'Dr. Rajesh Kumar',
          department: 'Computer Science'
        },
        '9123456789': {
          name: 'Prof. Priya Sharma',
          department: 'Information Technology'
        },
        '9988776655': {
          name: 'Dr. Amit Patel',
          department: 'Electronics'
        },
        '9978945632': {
          name: 'Pratik Patel',
          department: 'BCA'
        },
        '9876512340': {
          name: 'Prof. Sneha Desai',
          department: 'Mechanical Engineering'
        },
        '9123498765': {
          name: 'Dr. Rahul Shah',
          department: 'Civil Engineering'
        }
      };
      console.log('Using fallback teacher data');
    }
  }

  // Auto-fill student details when enrollment number is entered
  function checkEnrollment() {
    const enrollment = document.getElementById('studentEnrollment').value;
    
    if (enrollment.length === 12) {
      const studentData = studentDatabase[enrollment];
      
      if (studentData) {
        // Auto-fill the fields
        document.getElementById('studentName').value = studentData.name;
        document.getElementById('studentDept').value = studentData.department;
        document.getElementById('studentPhone').value = studentData.phone;
        
        // Disable the fields
        document.getElementById('studentName').disabled = true;
        document.getElementById('studentDept').disabled = true;
        document.getElementById('studentPhone').disabled = true;
        
        document.getElementById('studentMsg').innerHTML = '<p class="success-msg">‚úì Student details loaded!</p>';
      } else {
        // Clear and enable fields if enrollment not found
        document.getElementById('studentName').value = '';
        document.getElementById('studentDept').value = '';
        document.getElementById('studentPhone').value = '';
        document.getElementById('studentName').disabled = false;
        document.getElementById('studentDept').disabled = false;
        document.getElementById('studentPhone').disabled = false;
        document.getElementById('studentMsg').innerHTML = '<p class="error-msg">Enrollment not found. Please enter details manually.</p>';
      }
    } else {
      // Enable fields for manual entry
      document.getElementById('studentName').disabled = false;
      document.getElementById('studentDept').disabled = false;
      document.getElementById('studentPhone').disabled = false;
      document.getElementById('studentMsg').innerHTML = '';
    }
  }
  
  // Auto-fill teacher details when phone number is entered
  function checkTeacherPhone() {
    const phone = document.getElementById('teacherPhone').value;
    
    if (phone.length === 10) {
      const teacherData = teacherDatabase[phone];
      
      if (teacherData) {
        // Auto-fill the fields
        document.getElementById('teacherName').value = teacherData.name;
        document.getElementById('teacherDept').value = teacherData.department;
        
        // Disable the fields
        document.getElementById('teacherName').disabled = true;
        document.getElementById('teacherDept').disabled = true;
        
        document.getElementById('teacherMsg').innerHTML = '<p class="success-msg">‚úì Teacher details loaded!</p>';
      } else {
        // Clear and enable fields if phone not found
        document.getElementById('teacherName').value = '';
        document.getElementById('teacherDept').value = '';
        document.getElementById('teacherName').disabled = false;
        document.getElementById('teacherDept').disabled = false;
        document.getElementById('teacherMsg').innerHTML = '<p class="error-msg">Phone number not found. Please enter details manually.</p>';
      }
    } else {
      // Enable fields for manual entry
      document.getElementById('teacherName').disabled = false;
      document.getElementById('teacherDept').disabled = false;
      document.getElementById('teacherMsg').innerHTML = '';
    }
  }

  function showForm(type) {
    // Update tabs
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    event.target.classList.add('active');
    
    // Update forms
    document.querySelectorAll('.form-container').forEach(form => form.classList.remove('active'));
    document.getElementById(type + 'Form').classList.add('active');
    
    currentUserType = type;
  }

  function sendOTP(userType) {
    let phone, name;
    
    if (userType === 'student') {
      name = document.getElementById('studentName').value;
      phone = document.getElementById('studentPhone').value;
      const dept = document.getElementById('studentDept').value;
      const enrollment = document.getElementById('studentEnrollment').value;
      
      if (!name || !dept || !enrollment || !phone) {
        document.getElementById('studentMsg').innerHTML = '<p class="error-msg">Please fill all fields</p>';
        return;
      }
      if (enrollment.length !== 12) {
        document.getElementById('studentMsg').innerHTML = '<p class="error-msg">Enrollment must be 12 digits</p>';
        return;
      }
    } else if (userType === 'teacher') {
      name = document.getElementById('teacherName').value;
      phone = document.getElementById('teacherPhone').value;
      const dept = document.getElementById('teacherDept').value;
      
      if (!name || !dept || !phone) {
        document.getElementById('teacherMsg').innerHTML = '<p class="error-msg">Please fill all fields</p>';
        return;
      }
    } else if (userType === 'parents') {
      name = document.getElementById('parentName').value;
      phone = document.getElementById('parentPhone').value;
      const studentName = document.getElementById('parentStudentName').value;
      const studentDept = document.getElementById('parentStudentDept').value;
      
      if (!name || !studentName || !studentDept || !phone) {
        document.getElementById('parentsMsg').innerHTML = '<p class="error-msg">Please fill all fields</p>';
        return;
      }
    }
    
    if (phone.length !== 10) {
      document.getElementById(userType + 'Msg').innerHTML = '<p class="error-msg">Phone number must be 10 digits</p>';
      return;
    }
    
    // Generate random OTP
    generatedOTP = Math.floor(100000 + Math.random() * 900000).toString();
    
    // Show OTP section
    document.getElementById(userType + 'OTP').classList.add('show');
    document.getElementById(userType + 'Msg').innerHTML = `<p class="success-msg">OTP sent to ${phone}: <strong>${generatedOTP}</strong></p>`;
  }

  function verifyOTP(userType) {
    const otpInput = document.getElementById(userType + 'OtpInput').value;
    
    if (!otpInput) {
      document.getElementById(userType + 'Msg').innerHTML = '<p class="error-msg">Please enter OTP</p>';
      return;
    }
    
    if (otpInput === generatedOTP) {
      // Get user details based on user type
      let name, phone;
      
      if (userType === 'student') {
        name = document.getElementById('studentName').value;
        phone = document.getElementById('studentPhone').value;
      } else if (userType === 'teacher') {
        name = document.getElementById('teacherName').value;
        phone = document.getElementById('teacherPhone').value;
      } else if (userType === 'parents') {
        name = document.getElementById('parentName').value;
        phone = document.getElementById('parentPhone').value;
      }
      
      document.getElementById(userType + 'Msg').innerHTML = '<p class="success-msg">‚úì OTP Verified! Redirecting...</p>';
      
      // Redirect to category.html with user details as URL parameters
      setTimeout(() => {
        const params = new URLSearchParams({
          name: name,
          phone: phone,
          type: userType
        });
        window.location.href = 'category.html?' + params.toString();
      }, 1000);
    } else {
      document.getElementById(userType + 'Msg').innerHTML = '<p class="error-msg">Invalid OTP. Please try again.</p>';
    }
  }
</script>
</body>
</html>